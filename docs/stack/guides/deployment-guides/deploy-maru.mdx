---
title: Deploy Maru
description: Deploy Maru consensus layer client for The Linea stack
sidebar_position: 2
mainSource:
  url: 'https://github.com/Consensys/linea-monorepo'
image: /img/socialCards/deploy-maru.jpg
---

Maru is Linea's consensus layer client implementing QBFT consensus. This guide covers deploying Maru
nodes for your Linea stack network.

## Prerequisites

- Docker v24 or higher (recommended)
- Network configuration for P2P communication
- Minimum 4 nodes for QBFT fault tolerance
- Engine API JWT secret for communication with execution layer

:::tip

Docker is the recommended deployment method. It simplifies installation, updates, and management.
Only use binary distribution if Docker is not available in your environment.

:::

## Deploy with Docker

Docker is the recommended deployment method for Maru. Use the official Maru Docker image:

```bash
docker run -d \
  --name linea-maru \
  -p 8080:8080 \
  -p 9000:9000 \
  -v /path/to/maru-config.toml:/opt/consensys/maru/configs/maru-config.toml:ro \
  -v /path/to/log4j.xml:/opt/consensys/maru/configs/log4j.xml:ro \
  -v /path/to/jwt:/opt/consensys/maru/configs/jwt:ro \
  -v maru-data:/opt/maru \
  consensys/maru:latest \
  --network linea-mainnet \
  --config /opt/consensys/maru/configs/maru-config.toml
```

## Alternative: Binary distribution

If you cannot use Docker, you can build and run Maru from source. This method requires more setup and
maintenance:

1. Clone the Maru repository.
```bash
git clone https://github.com/Consensys/maru.git
cd maru
```

2. Build the distribution.
```bash
./gradlew :app:installDist
```

3. Run Maru.
```bash
./app/build/install/app/bin/app \
  --maru-genesis-file=docker/initialization/genesis-maru.json \
  --config=docker/maru/config.dev.toml
```

## Configuration

### Basic configuration

Create `maru-config.toml`:

```toml
[persistence]
data-path = "/opt/maru/data"
private-key-path = "/opt/maru/private-key"

[p2p]
port = 9000
ip-address = "0.0.0.0"
static-peers = [
  "/ip4/PEER_IP/tcp/PEER_PORT/p2p/PEER_ID",
  # Add additional peers
]
reconnect-delay = "500ms"

[payload-validator]
engine-api-endpoint = { endpoint = "http://el-client:8550", jwt-secret-path = "/opt/consensys/maru/configs/jwt" }
eth-api-endpoint = { endpoint = "http://el-client:8545" }
payload-validation-enabled = false

[observability]
port = 9090
jvm-metrics-enabled = true
prometheus-metrics-enabled = true

[api]
port = 8080

[syncing]
peer-chain-height-polling-interval = "5s"
el-sync-status-refresh-interval = "5s"
sync-target-selection = "Highest"
desync-tolerance = 0
```

### QBFT configuration

For QBFT consensus, configure validator set:

- Minimum 4 nodes required for fault tolerance (3f+1)
- Configure validator addresses in genesis or via governance
- Set up static peers for initial network discovery

### Network configuration

Configure P2P networking:

- Set `p2p.port` for P2P communication
- Add static peers in `p2p.static-peers`
- Configure `p2p.ip-address` (use `0.0.0.0` for all interfaces)

### Execution layer connection

Configure connection to execution layer:

- Set `payload-validator.engine-api-endpoint` to execution layer Engine API
- Set `payload-validator.eth-api-endpoint` to execution layer RPC
- Provide JWT secret for Engine API authentication

## Ports

Maru uses these ports:

- **8080**: REST API for monitoring and control
- **9000**: P2P networking (TCP and UDP)
- **9090**: Metrics endpoint (Prometheus)

## Minimum node requirements

For QBFT consensus:

- **Minimum nodes**: 4 nodes for fault tolerance
- **Fault tolerance**: Can tolerate up to 1/3 of nodes being faulty (3f+1)
- **Network partitions**: Partitions affecting more than 1/3 of nodes can cause consensus failure

## Verification

Verify Maru deployment:

1. Check Maru is running.
```bash
docker logs linea-maru
```

2. Check REST API.
```bash
curl http://localhost:8080/health
```

3. Check metrics.
```bash
curl http://localhost:9090/metrics
```

4. Verify P2P connectivity with other nodes.

## Troubleshooting

### Maru cannot connect to execution layer

- Verify execution layer is running and accessible
- Check Engine API JWT secret is correct
- Verify network connectivity between Maru and execution layer

### Consensus not progressing

- Verify minimum 4 nodes are running for QBFT
- Check P2P connectivity between nodes
- Verify validator set is correctly configured

### High memory usage

- Adjust JVM options: `-Xmx2g` (or appropriate for your resources)
- Monitor memory usage and adjust as needed

## Related documentation

- [Deploy execution layer](/stack/guides/deployment-guides/deploy-execution-layer): Connecting
  execution layer to Maru
- [Configuration Guides](/stack/guides/configuration-guides): Advanced Maru configuration
- [Operations Guides](/stack/guides/operations-guides): Operational procedures for Maru
